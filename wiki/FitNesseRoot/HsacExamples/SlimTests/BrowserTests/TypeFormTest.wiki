!define FORM_UID {fdx32Y}

|script     |string fixture                  |
|$myComment=|value of|More !randomString (10)|

|storyboard      |browser test                                          |
|open            |https://fhoeben.typeform.com/to/${FORM_UID}           |
|click           |Start                                                 |
|type            |Fried                                                 |
|press           |enter                                                 |
|type            |example.com                                           |
|click           |Ok                                                    |
|type            |A                                                     |
|wait for visible|How often do you write automated tests?               |
|type            |9                                                     |
|wait for visible|could you share your email address with us?           |
|type            |test@example.com                                      |
|press           |enter                                                 |
|type            |4                                                     |
|wait for visible|Will you be staying for the afterparty?               |
|type            |A                                                     |
|wait for visible|Do you have any comments or suggestions for the event?|
|type            |$myComment                                            |
|press           |enter                                                 |
|click           |Register!                                             |
|wait for visible|Thanks for completing this typeform                   |
|click           |Create a typeform                                     |


!define API_KEY {96a5b83b3cfb12c128fa62debeb9dfb51d96a59e}

|script   |json http test                   |
|set value|${API_KEY}     |for|key          |
|get from |https://api.typeform.com/v1/forms|
|check    |response status|200              |
|show     |response                         |

|script         |json http test                                                                                                                              |
|set value      |${API_KEY}     |for                      |key                                                                                               |
|set value      |true           |for                      |completed                                                                                         |
|set value      |10             |for                      |limit                                                                                             |
|get from       |https://api.typeform.com/v1/form/${FORM_UID}                                                                                                |
|check          |response status|200                                                                                                                         |
|show           |response                                                                                                                                    |
|show           |json path      |stats.responses.total                                                                                                       |
|check          |json path      |stats.responses.completed|> 0                                                                                               |
|check          |json path      |stats.responses.showing  |0 < _ <= 10                                                                                       |
|$suggestion_id=|element        |0                        |of json path|questions[?(@.question=="Do you have any comments or suggestions for the event?")].id|
|check          |element        |0                        |of json path|responses[-1:].answers.$suggestion_id|$myComment                                     |

